<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <!-- Grant portal access to the customer -->
    <record id="grant_portal_access" model="portal.wizard.user">
        <field
            name="user_id"
            model="res.partner"
            eval="[
                Command.create(
                    {
                        'partner_id': ref('base.res_partner_3'),
                        'email': obj(ref('base.res_partner_3')).email,
                        'is_portal': True,
                    }
                ),
            ]"
        />
    </record>
    <function model="portal.wizard.user" name="action_grant_access" eval="[ref('grant_portal_access')]" />

    <!-- Set a password for the portal user so it may log-in -->
    <record id="set_password_portal_user" model="change.password.wizard">
        <field
            name="user_ids"
            model="res.partner"
            eval="[
                Command.create(
                    {
                        'user_id': obj(ref('base.res_partner_3')).user_ids.id,
                        'user_login': obj(ref('base.res_partner_3')).email,
                        'new_passwd': obj(ref('base.res_partner_3')).email,
                    }
                ),
            ]"
        />
    </record>
    <function model="change.password.wizard" name="change_password_button" eval="[ref('set_password_portal_user')]" />

</odoo>
